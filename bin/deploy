#!/bin/bash
set -ev

export DO_SPACES_ENDPOINT="https://nyc3.digitaloceanspaces.com"
export DO_SPACE_NAME="joshashby-com"
export CURRENT_DATE=$(date -u "+%FT%H%M%S")
export PACKAGE="deploy-${CURRENT_DATE}.tar.gz"

echo "Building backup package ${PACKAGE} ..."
tar -zcvf "${PACKAGE}" _site

echo "Uploading backup ${PACKAGE} to DO space ..."
aws s3 cp $PACKAGE "s3://${DO_SPACE_NAME}/deploys/" --endpoint ${DO_SPACES_ENDPOINT}

echo "Uploading site to DO space ..."
aws s3 cp _site/ "s3://${DO_SPACE_NAME}/" --recursive --endpoint ${DO_SPACES_ENDPOINT}

